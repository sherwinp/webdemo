<?xml version="1.0" encoding="utf-8"?>
<html 
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
	<meta name="viewport"
		content="height=device-height,width=device-width, initial-scale=1.0, user-scalable=yes" />
	<link rel="shortcut icon" href="#{request.contextPath}/favicon.ico" />
	<title>webdemo</title>
	<link rel="stylesheet" href="resources/style.css" type="text/css" />
	<script type="text/javascript" src="resources/jquery.min.js"></script>
</h:head>
<h:body>
<p>Item:</p>
<div id="list">
</div><span style="float: left; margin: 40px; width: 200px;">
				<img style=" width:auto; max-width:100%; height:auto;" id="qrcode" alt="qrcode" src="qrcode?s=4" /></span>
				
        <script type="text/javascript" src="resources/handlebars.js" ></script>
		<script type="text/javascript">
		  	function doGeolocation() {
			    if (navigator.geolocation) {
			      navigator.geolocation.getCurrentPosition(positionSuccess, positionError);
			    } else {
			      positionError(-1);
			    }
			}
		    function positionError(err) {
		        var msg;
		        switch(err.code) {
		          case err.UNKNOWN_ERROR:
		            msg = "Unable to find your location";
		            break;
		          case err.PERMISSION_DENINED:
		            msg = "Permission denied in finding your location";
		            break;
		          case err.POSITION_UNAVAILABLE:
		            msg = "Your location is currently unknown";
		            break;
		          case err.BREAK:
		            msg = "Attempt to find location took too long";
		            break;
		          default:
		            msg = "Location detection not supported in browser";
		        }
		        document.getElementById('info').innerHTML = msg;
		     }
		    function positionSuccess(position) {
		    	
		    }
			window.onload = function(){
				doGeolocation();
				$.ajax({
					   url: 'api/vouchers',
					   data: {
					      format: 'json'
					   },
					   error: function() {
						   console.log( "error ajax: load. " );
					   },
					   dataType: 'json',
					   success: function(data) {
						   console.log( "success." );
				            var Source = document.getElementById('container-template').textContent;
				            // Compile Template 
				            var Template = Handlebars.compile(Source);
				            console.log(data);
				            $('#list').html(Template(data));
					   },
					   type: 'GET'
					});
			};
		</script>
	    <script id="container-template" type="x-handlebars-template">
            <ul id="vouchers">
           	  {{#each this}}
				{{#if @first}}
               <li><a href="item.html?id={{this.id}}">redeemable item: {{this.descr}}</a><img src="resources/{{this.descr}}"/></li>
				{{/if}}
              {{/each}}
            </ul>
        </script>
</h:body>
</html>